  Copy code
  version: 2.1

  orbs:
    flutter: circleci/flutter@2.0.2

  jobs:
    distribute:
      macos:
        xcode: 12.5.1
      steps:
        - flutter/install_sdk_and_pub:
            version: 3.0.3
        - flutter/install_ios_pod
        - flutter/install_ios_gem
        - run:
            command: bundle exec fastlane distribute
            working_directory: ios
    ci:
      steps:
        - checkout
        - flutter/install_sdk_and_pub:
            version: 3.3.10
        - run: flutter pub global activate melos 2.9.0
        - run: export PATH="$PATH:$HOME/.pub-cache/bin"
        - run: flutter clean
        - run: flutter pub upgrade
        - run: flutter pub get
        - run: flutter pub global run melos bs
        - run: flutter pub global run melos run-script flutter test

    workflows:
      distribute:
        jobs:
          - distribute
          - ci