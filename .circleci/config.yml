version: 2.1

setup: true

orbs:
  path-filtering: circleci/path-filtering@0.1.4


parameters:
  daily-memo-deploy:
    type: boolean
    default: false
  exchange-calculator-deploy:
    type: boolean
    default: false


workflows:
  generate-config:
    jobs:
      - path-filtering/filter:
          name: root_ci
          mapping: |
            apps/daily_memo/.* daily_memo_ci_run true
            apps/exchange_rate_calculator/.* exchange_calculator_ci_run true
          base-revision: develop
#          config-path: apps/daily_memo/.circleci/config.yml
          config-path: .circleci/common_jobs.yml
#      - path-filtering/filter:
#           name: exchange_rate_calculator_ci
#           mapping: |
#             apps/exchange_rate_calculator/.* ci_run true
#           base-revision: develop
#           config-path: apps/exchange_rate_calculator/.circleci/config.yml
#  daily-memo-cd:
#    when:
#      equal: [ true, << pipeline.parameters.daily-memo-deploy >> ]
#    jobs:
#      - path-filtering/filter:
#          name: daily_memo_cd
#          base-revision: master
#          config-path: apps/daily_memo/.circleci/deploy_config.yml
#  exchange-calculator-cd:
#    when:
#      equal: [ true, << pipeline.parameters.exchange-calculator-deploy >> ]
#    jobs:
#      - path-filtering/filter:
#          name: exchange-calculator-cd
#          base-revision: master
#          config-path: apps/exchange_rate_calculator/.circleci/deploy_config.yml