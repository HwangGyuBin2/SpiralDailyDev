version: 2.1

setup: true

parameters:
  common:
    type: boolean
    default: false

  daily_memo:
    type: boolean
    default: false

  exchange_rate_calculator:
    type: boolean
    default: false

  spiral_map:
    type: boolean
    default: false

executors:
  android-flutter:
    docker:
      - image: gmemstr/flutter-fastlane-android:29.0
    environment:
      TERM: dumb
      _JAVA_OPTIONS: "-Xmx2048m -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap"
      GRADLE_OPTS: '-Dorg.gradle.jvmargs="-Xmx2048m"'

orb:
  path-filtering: circleci/path-filtering@0.1.6
  continuation: circleci/continuation@0.3.1

jobs:
  daily-memo-ci-job:
    executor: path-filtering/default
    resource_class: small
    steps:
      - checkout
      - continuation/continue:
          configuration_path: apps/daily_memo/.circleci/config.yml

  exchange-rate-calculator-ci-job:
    executor: path-filtering/default
    resource_class: small
    steps:
      - checkout
      - continuation/continue:
          configuration_path: apps/exchange_rate_calculator/.circleci/config.yml

  spiral-daily-ci-job:
    executor: path-filtering/default
    resource_class: small
    steps:
      - checkout
      - continuation/continue:
          configuration_path: apps/spiral_map/.circleci/config.yml



workflows:
#  common_ci:
#    when: << pipeline.parameters.common >>
#    jobs:
  daily_memo_ci:
    when: << pipeline.parameters.daily_memo >>
    jobs:
      - daily-memo-ci-job

  exchange_rate_calculator_ci:
    when: << pipeline.parameters.exchange_rate_calculator >>
    jobs:
      - exchange-rate-calculator-ci-job

  spiral_map_ci:
    when: << pipeline.parameters.spiral_map >>
    jobs:
      - spiral-daily-ci-job

